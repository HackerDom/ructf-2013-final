0) CONFIG_CFQ_GROUP_IOSCHED=y
CONFIG_BLK_DEV_THROTTLING=y
0.1) Latest kernel
1) квоты
2) cgroups для каждого сервиса
3) init-скрипты
4) права в /home
5) pam_cgroups в system-auth и start-stop-daemon

6.0) emerge ruby mongodb erlang
     package { 'app-portage/layman': ensure => present }
     package { 'dev-util/strace': ensure => present }
     package { 'sys-process/htop': ensure => present }
6.1)
6.3) export SYBASE="/usr"
6.3) cpan install mango
6.4) g-cpan -i MongoDB
su user -s /bin/bash
cd
mkdir mongodb mongodb/run mongodb/db mongodb/log
rc-update add mongodb_user
6.6) quota user 2gb

7.1) use ithreads
8) services:
user(10000) Users API (and)
database(10001) Database API ? (umineko & krait, C++)
mr(10002) MapReduce (Егор, erlang)
ses(10003) Simple Email Service (dimmo, perl)
dns(10004) Cache DNS (lena, ruby)
proxy(10005) TCP Balancer (kost, C)
queue(10006) Message Queue (bay, rust)
Script API (andgein, PHP)
9) python2 by default
9.1) layman -a yac

10) nginx.conf, rc-update add nginx default
mkdir -p /var/lib/overlays/cpan/
PORTDIR_OVERLAY="/var/lib/overlays/cpan/"

------------------------ SERVICE DEPLOYMENT ------------------------

=== user service ===
chown -R user:user /home/user
chmod +x /etc/init.d/user /etc/init.d/mongodb_user

g-cpan -i Mojolicious
g-cpan -i MongoDB

rc-update add user
rc-update add mongodb_user


=== database service ===
chown -R database:database /home/database
chmod +x /etc/init.d/database

rc-update add database


=== mr service ===
chown -R mr:mr /home/mr
chmod +x /etc/init.d/mr

rc-update add mr


=== ses service ===
chown -R ses:ses /home/ses
chmod +x /etc/init.d/ses_http /etc/init.d/ses_smtp

# В /etc/postfix/main.cf раскомментировать строку mynetworks_style = host
# В /etc/postfix/main.cf раскомментировать строку home_mailbox = Maildir/


rc-update add ses

=== dns service ===
chown -R dns:dns /home/dns
chmod +x /etc/init.d/dns

mysql_install_db --user=dns --datadir=/home/dns/mysql/db/ --skip-name-resolve --defaults-file=/home/dns/mysql/my.cnf

rc-update add dns
rc-update add dns_web
rc-update add mysql_dns

=== queue service ===
chown -R queue:queue /home/queue
chmod +x /etc/init.d/queue /etc/init.d/queue_web

rc-update add queue
rc-update add queue_web

